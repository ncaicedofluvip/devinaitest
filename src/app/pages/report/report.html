<main class="report-page">
  <!-- Loading State -->
  @if (state() === 'loading') {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">Fetching profile report...</p>
    </div>
  }

  <!-- Error State -->
  @if (state() === 'error') {
    <div class="error-container">
      <div class="error-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
      </div>
      <h2 class="error-title">Failed to load report</h2>
      <p class="error-status">Status: {{ error()?.status || 'Unknown' }}</p>
      <p class="error-message">{{ error()?.message || 'An unexpected error occurred' }}</p>
      <div class="error-actions">
        <button class="btn btn-primary" (click)="onRetry()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 4v6h6M23 20v-6h-6"/>
            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
          </svg>
          Retry
        </button>
        <button class="btn btn-secondary" (click)="onBack()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back
        </button>
      </div>
    </div>
  }

  <!-- Success State -->
  @if (state() === 'success') {
    <div class="report-container">
      <!-- Header with data source info -->
      <div class="report-header">
        <div class="data-source-info">
          <span class="data-source-badge" [class.from-cache]="fromCache()">
            Data source: {{ dataSource() }}
          </span>
          <span class="last-updated">
            Last updated: {{ fetchedAtFormatted() }}
          </span>
        </div>
        <div class="header-actions">
          <button class="btn btn-outline" (click)="onRefresh()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 4v6h6M23 20v-6h-6"/>
              <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
            </svg>
            Refresh
          </button>
          <button class="btn btn-primary" (click)="onExport()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Export JSON
          </button>
          <button class="btn btn-ghost" (click)="onBack()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            Back
          </button>
        </div>
      </div>

      <!-- Profile Card -->
      <div class="profile-card">
        <div class="profile-header">
          @if (getProfilePicture()) {
            <img [src]="getProfilePicture()" [alt]="getProfileName()" class="profile-avatar" />
          } @else {
            <div class="profile-avatar-placeholder">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
            </div>
          }
          <div class="profile-info">
            <div class="profile-name-row">
              <h1 class="profile-name">{{ getProfileName() }}</h1>
              @if (isVerified()) {
                <svg class="verified-badge" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
              }
            </div>
            <p class="profile-username">&#64;{{ getProfileUsername() }}</p>
            <div class="profile-platform">
              <svg class="platform-icon" viewBox="0 0 24 24" fill="currentColor">
                <path [attr.d]="getPlatformIcon()"/>
              </svg>
              <span>{{ getPlatformName() }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Metrics Grid -->
      <div class="metrics-section">
        <h2 class="section-title">Key Metrics</h2>
        <div class="metrics-grid">
          <div class="metric-card">
            <span class="metric-label">Followers</span>
            <span class="metric-value">{{ getFollowers() }}</span>
          </div>
          <div class="metric-card">
            <span class="metric-label">Following</span>
            <span class="metric-value">{{ getFollowing() }}</span>
          </div>
          <div class="metric-card">
            <span class="metric-label">Engagement Rate</span>
            <span class="metric-value">{{ getEngagementRate() }}</span>
          </div>
          <div class="metric-card">
            <span class="metric-label">Avg. Likes</span>
            <span class="metric-value">{{ getAvgLikes() }}</span>
          </div>
          <div class="metric-card">
            <span class="metric-label">Avg. Comments</span>
            <span class="metric-value">{{ getAvgComments() }}</span>
          </div>
          <div class="metric-card">
            <span class="metric-label">Avg. Views</span>
            <span class="metric-value">{{ getAvgViews() }}</span>
          </div>
          <div class="metric-card">
            <span class="metric-label">Total Posts</span>
            <span class="metric-value">{{ getTotalPosts() }}</span>
          </div>
        </div>
      </div>

      <!-- Raw JSON Panel -->
      <div class="raw-json-section">
        <h2 class="section-title">Raw JSON Response</h2>
        <div class="json-panel">
          <pre class="json-content">{{ getRawJson() }}</pre>
        </div>
      </div>
    </div>
  }
</main>
